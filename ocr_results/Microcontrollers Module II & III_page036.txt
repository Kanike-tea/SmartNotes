Microcontrollers — BCS402

have been removed from the inside loop, saving three cycles per loop compared to

checksum_v3.
2.2 Function Argument Types

Converting local variables from types char or short to type int increases performance and
reduces code size. The same holds for function arguments. Consider the following simple

function, which adds two 16-bit values, halving the second, and returns a 16-bit sum:

short add_vl(short a, short b)
{

return a + (b>>1);
}

This function is a little artificial, but it is a useful test case to illustrate the problems faced by
the compiler. The input values a, b, and the return value will be passed in 32-bit ARM
registers. Should the compiler assume that these 32-bit values are in the range of a short type,
that is, —32,768 to +32,767? Or should the compiler force values to be in this range by sign-
extending the lowest 16 bits to fill the 32-bit register? The compiler must make compatible
decisions for the function caller and callee. Either the caller or callee must perform the cast to

a short type.

We say that function arguments are passed wide if they are not reduced to the range of the
type and narrow if they are. You can tell which decision the compiler has made by looking at
the assembly output for add_v1. If the compiler passes arguments wide, then the callee must
reduce function arguments to the correct range. If the compiler passes arguments narrow,
then the caller must reduce the range. If the compiler returns values wide, then the caller must
reduce the return value to the correct range. If the compiler returns values narrow, then the

callee must reduce the range before returning the value.

For armce n ADS, function arguments are passed narrow and values returned narrow. In other
words, the caller casts argument values and the callee casts return values. The compiler uses

the ANSI prototype of the function to determine the data types of the function arguments.

The armcc output for add_v1 shows that the compiler casts the return value to a short type,
but does not cast the input values. It assumes that the caller has already ensured that the 32-
bit valuesrO and rl are in the range of the short type. This shows narrow passing of arguments

and return value.

Dept. of ECE, GSSSIETW Page 37