Microcontrollers — BCS402

have been removed from the inside loop, saving three cycles per loop compared to

Converting local variables from types char or short to type int increases performance and
reduces code size. The same holds for function arguments. Consider the following simple

function, which adds two 16-bit values, halving the second, and returns a 16-bit sum:

short add_vl(short a, short b)
{

return a + (b>>1);

}

This function is a little artificial, but it is a useful test case to illustrate the problems faced by
the compiler. The input values a, b, and the return value will be passed in 32-bit ARM
registers. Should the compiler assume that these 32-bit values are in the range of a short type,
that is, —32,768 to +32,767? Or should the compiler force values to be in this range by sign-
extending the lowest 16 bits to fill the 32-bit register? The compiler must make compatible

decisions for the function caller and callee. Either the caller or callee must perform the cast to

2
gL
>
°
a

S
3
es

The armcc output for add_v1 shows that the compiler casts the return value to a short type,
but does not cast the input values. It assumes that the caller has already ensured that the 32-
bit valuesrO and rl are in the range of the short type. This shows narrow passing of arguments

and return value.

Dept. of ECE, GSSSIETW Page 37