7.3 Division 235

Finally II] and [12 set q to a new Q16 estimate x,. Since the carry flag is clear from 109,
the SBC underestimates the reciprocal.

x1 = 2x9 — dx6 +go for some —27!° < g <0 (7.35)
Using Equation (7.33) for the new error:
0<e =de — gy < de +2-° (7.36)
113 calculates a Q15 estimate qi to the quotient nd~!:

qu = nx — hy = 5 =e (7.37)

where 0 < hy < 275 is the truncation error and
e = ne thy <dey thy <E+h, <2-4 (7.38)

The bound on E is from Section 7.3.3.1. So, qi is an underestimate to nd~! of error less
than 2~!*, Finally 115, 116, 17, and I18 calculate the remainder n — qd and correct the
estimate to Q15 precision.

7.3.3.4 Q31 Fixed-Point Division by Newton-Raphson

We calculate a Q31 representation of the ratio nd~!, where n and d are 32-bit positive
integers in the range 0 < n < d < 23! In other words we calculate

q = (unsigned int) (((unsigned long long)n<<31)/d);

You can use the routine udiv_64by32_arm7m in Section 7.3.1.3 to do this by trial
subtraction. However, the following routine calculates exactly the same result but uses
fewer cycles on an ARMOE. If you only need an estimate of the result, then you can remove
the nine instructions [21 to 129, which correct the error of the initial estimate.

Aswith the previous section, we show the assembly code followed by a proof of accuracy.
The routine uses 46 cycles, including return, on an ARM9E. The routine uses the same
lookup table as for the Q15 routine in Section 7.3.3.3.

RN 0 5 input denominator d, quotient estimate q
RN 1 ; input numerator n, remainder high r
RN 2 3 normalization shift, scratch register

RN 3; Q31 normalized denominator 2°30<=d<2"31
RN 12 3 scratch

pause

; unsigned udiv_q31_arm9e(unsigned d, unsigned q)
udiv_q3l_arm9e ; instruction number : comment