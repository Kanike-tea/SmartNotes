816

Chapter 22 Database Recovery Techniques

the item must be located on disk, and the appropriate disk pages are copied into the
cache. It may be necessary to replace (or flush) some of the cache buffers to make
space available for the new item (see Section 20.2.4).

The entries in the DBMS cache directory hold additional information relevant to
buffer management. Associated with each buffer in the cache is a dirty bit, which
can be included in the directory entry to indicate whether or not the buffer has been
modified. When a page is first read from the database disk into a cache buffer, a new
entry is inserted in the cache directory with the new disk page address, and the dirty
bit is set to 0 (zero). As soon as the buffer is modified, the dirty bit for the corre-
sponding directory entry is set to 1 (one). Additional information, such as the trans-
action id(s) of the transaction(s) that modified the buffer, are also kept in the
directory. When the buffer contents are replaced (flushed) from the cache, the con-
tents must first be written back to the corresponding disk page only if its dirty bit is 1.

Another bit, called the pin-unpin bit, is also needed—a page in the cache is pinned
(bit value 1 (one)) if it cannot be written back to disk as yet. For example, the recov-
ery protocol may restrict certain buffer pages from being written back to the disk
until the transactions that changed this buffer have committed.

Two main strategies can be employed when flushing a modified buffer back to disk.
The first strategy, known as in-place updating, writes the buffer to the same origi-
nal disk location, thus overwriting the old value of any changed data items on disk.”
Hence, a single copy of each database disk block is maintained. The second strategy,
known as shadowing, writes an updated buffer at a different disk location, so mul-
tiple versions of data items can be maintained, but this approach is not typically
used in practice.

In general, the old value of the data item before updating is called the before image
(BFIM), and the new value after updating is called the after image (AFIM). If shad-
owing is used, both the BFIM and the AFIM can be kept on disk; hence, it is not
strictly necessary to maintain a log for recovering. We briefly discuss recovery
based on shadowing in Section 22.4.

22.1.3 Write-Ahead Logging, Steal/No-Steal,
and Force/No-Force

When in-place updating is used, it is necessary to use a log for recovery (see Sec-
tion 21.2.2). In this case, the recovery mechanism must ensure that the BFIM of the
data item is recorded in the appropriate log entry and that the log entry is flushed to
disk before the BFIM is overwritten with the AFIM in the database on disk. This
process is generally known as write-ahead logging and is necessary so we can
UNDO the operation if this is required during recovery. Before we can describe a
protocol for write-ahead logging, we need to distinguish between two types of log
entry information included for a write command: the information needed for UNDO

?In-place updating is used in most systems in practice.