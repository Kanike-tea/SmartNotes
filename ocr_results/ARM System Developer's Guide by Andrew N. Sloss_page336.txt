9.1 Exception Handling 323

Table 9.4 — Useful link-register-based addresses.

Exception Address Use
Reset _— Iris not defined on a Reset
Data Abort Ir—8 points to the instruction that caused the Data Abort exception
FIQ Ir-4 return address from the FIQ handler
IRQ Ir-4 return address from the IRQ handler
Prefetch Abort Ir-4 points to the instruction that caused the Prefetch Abort exception
SWl Ir points to the next instruction after the SWI instruction
Undefined Instruction — Ir points to the next instruction after the undefined instruction
ExaMPLe This example shows that a typical method of returning from an IRQ and FIQ handler is to
. use a SUBS instruction:
handler
<handler code>
SUBS pc, rl4, #4 3 pe=rl4-4
Because there is an S at the end of the SUB instruction and the pc is the destination register,
the cpsr is automatically restored from the spsr register.
EXAMPLE This example shows another method that subtracts the offset from the link register r14 at
9.3 the beginning of the handler.
handler
SUB rl4, rl4, #4 3 rld-=4
<handler code>
MOVS pc, 14 3; return
After servicing is complete, return to normal execution occurs by moving the link register
r14 into the pcand restoring cpsr from the spsr.
ExamMPLe The final example uses the interrupt stack to store the link register. This method first
9.4 subtracts an offset from the link register and then stores it onto the interrupt stack.

handler
suB_ orld, rl4, #4 5 rl4-=4