Microcontrollers — BCS402

This compiles to

timers_vl
LOR r3, [r0, #0] 3 73 = *timerl
LDR r12,[r2,#0] 3 rl2 = *step
ADD r3,r3,r12 3 73 += rl2
STR r3,[r0, #0] 3 *timerl = r3
LOR r0, [r1, #0] 3 rO = *timer2
LOR r2,[r2,#0] 3 r2 = *step
ADD r0,r0,r2 3 0 += r2
STR r0,[r1, #0] 3 *timer2 = tO
MOV pe,rl4 3 return

Note that the compiler loads from step twice. Usually a compiler optimization called common
subexpression elimination would kick in so that *step was only evaluated once, and the value
reused for the second occurrence. However, the compiler can’t use this optimization here.
The pointers timer! and step might alias one another. In other words, the compiler cannot be
sure that the write to timer! doesn’t affect the read from step. In this case the second value of
*step is different from the first and has the value *timerl. This forces the compiler to insert
an extra load instruction.
Avoiding Pointer Aliasing
¢ Do not rely on the compiler to eliminate common sub expressions involving memory
accesses. Instead create new local variables to hold the expression. This ensures the
expression is evaluated only once.
e Avoid taking the address of local variables. The variable may be inefficient to access

from then on.

7. Portability Issues

Here is a summary of the issues you may encounter when porting C code to the ARM.

The char type: On the ARM, char is unsigned rather than signed. A common problem
concerns loops that use a char loop counter i and the continuation condition i > 0, they
become infinite loops. In this situation, armcc produces a warning of unsigned comparison
with zero. You should either use a compiler option to make char signed or change loop
counters to type int.

The int type: Some older architectures use a 16-bit int, which may cause problems when
moving to ARM’s 32-bit int type although this is rare nowadays. Note that expressions are
promoted to an int type before evaluation. Therefore if i = -0x1000, the expression i ==

OxF000 is true on a 16-bit machine but false on a 32- bit machine.

Dept. of ECE, GSSSIETW Page 49