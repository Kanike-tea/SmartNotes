Microcontrollers — BCS402

Example: This example shows how to use a do-while loop to remove the test for N being

zero that occurs in a for loop.

int checksum_v8(int *data, unsigned int N)
{

int sum=0;
do

sum += *(datat+) ;
} while (--N!=0);
return sum;

}

The compiler output is now

checksum_v8

MoV 12,#0 ; sum = 0
checksum_v8_loop

LDR r3, [ro], # 3 73 = *(datat+)

SUBS rl,rl, #1 3 N-- and set flags

ADD r2,7r3,7r2 3; sum += r3

BNE checksum_v8_ loop ; if (N!=0) goto loop

MoV ro,r2 ; ro = sum

Mov pe,rl4 3 return ro

3.3 Loop Unrolling

In loops using fixed number of iterations each loop iteration costs two instructions in addition

to the body of the loop: a subtract to decrement the loop count and a conditional branch.

These instructions are called as the loop overhead. On ARM7 or ARMQO processors the
subtract takes one cycle and the branch three cycles, giving an overhead of four cycles per

loop.

Some of these cycles by unrolling a loop—repeating the loop body several times, and

reducing the number of loop iterations by the same proportion.

Example 1: The following code unrolls our packet checksum loop by four times. We assume

that the number of words in the packet N is a multiple of four.

Dept. of ECE, GSSSIETW Page 43