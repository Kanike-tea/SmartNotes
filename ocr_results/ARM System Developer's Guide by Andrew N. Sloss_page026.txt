1.4 Embedded System Software 13

The operating system provides an infrastructure to control applications and manage
hardware system resources. Many embedded systems do not require a full operating system
but merely a simple task scheduler that is either event or poll driven.

The device drivers are the third component shown in Figure 1.4. They provide
a consistent software interface to the peripherals on the hardware device.

Finally, an application performs one of the tasks required for a device. For example,
amobile phone might have a diary application. There may be multiple applications running
on the same device, controlled by the operating system.

The software components can run from ROM or RAM. ROM code that is fixed on the
device (for example, the initialization code) is called firmware.

1.4.1 INITIALIZATION (BOOT) CODE

EXAMPLE

ll

Initialization code (or boot code) takes the processor from the reset state to a state where the
operating system can run. It usually configures the memory controller and processor caches
and initializes some devices. In a simple system the operating system might be replaced by
a simple scheduler or debug monitor.

The initialization code handles a number of administrative tasks prior to handing control
over to an operating system image. We can group these different tasks into three phases:
initial hardware configuration, diagnostics, and booting.

Initial hardware configuration involves setting up the target platform so it can boot
an image. Although the target platform itself comes up in a standard configuration, this
configuration normally requires modification to satisfy the requirements of the booted
image. For example, the memory system normally requires reorganization of the memory
map, as shown in Example 1.1.

Diagnostics are often embedded in the initialization code. Diagnostic code tests the
system by exercising the hardware target to check if the target is in working order. It also
tracks down standard system-related issues. This type of testing is important for manu-
facturing since it occurs after the software product is complete. The primary purpose of
diagnostic code is fault identification and isolation.

Booting involves loading an image and handing control over to that image. The boot
process itself can be complicated if the system must boot different operating systems or
different versions of the same operating system.

Booting an image is the final phase, but first you must load the image. Loading an image
involves anything from copying an entire program including code and data into RAM, to
just copying a data area containing volatile variables into RAM. Once booted, the system
hands over control by modifying the program counter to point into the start of the image.

Sometimes, to reduce the image size, an image is compressed. The image is then
decompressed either when it is loaded or when control is handed over to it.

Initializing or organizing memory is an important part of the initialization code because
many operating systems expect a known memory layout before they can start.