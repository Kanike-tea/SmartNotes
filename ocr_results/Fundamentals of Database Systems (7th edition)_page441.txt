12.5 The Object Query Language OOL

a set of references to all FACULTY objects that are related to the DEPARTMENT object
whose persistent name is CS_DEPARTMENT via the relationship Has_faculty; that is, a
set of references to all FACULTY objects who are working in the Computer Science
department. Now, to return the ranks of Computer Science faculty, we cannot write

Q3’

CS_DEPARTMENT.Has_faculty.Rank;

because it is not clear whether the object returned would be of type set<string> or
bag<string> (the latter being more likely, since multiple faculty may share the same
rank). Because of this type of ambiguity problem, OQL does not allow expressions
such as Q3’, Rather, one must use an iterator variable over any collections, as in
Q3A or Q3B below:

Q3A: select — F.Rank
from F in CS_DEPARTMENT.Has_faculty;

Q3B: select distinct F.Rank
from F in CS_DEPARTMENT.Has_faculty;

Here, Q3A returns bag<string> (duplicate rank values appear in the result), whereas
Q3B returns set<string> (duplicates are eliminated via the distinct keyword). Both
Q3A and Q3B illustrate how an iterator variable can be defined in the from clause to
range over a restricted collection specified in the query. The variable F in Q3A and
Q3B ranges over the elements of the collection CS_DEPARTMENT.Has_faculty, which
is of type set<FACULTY>, and includes only those faculty who are members of the
Computer Science department.

In general, an OQL query can return a result with a complex structure specified in
the query itself by utilizing the struct keyword. Consider the following examples:

Q4: CS_DEPARTMENT.Chair.Advises;

Q4A: select struct ( name: struct (last_name: S.name.Lname, first_name:
S.name.Fname),
degrees:( select struct (deg: D.Degree,
yr: D.Year,
college: D.College)
from D in S.Degrees ))
from S in CS_DEPARTMENT.Chair.Advises;

Here, Q4 is straightforward, returning an object of type set<GRAD_STUDENT> as its
result; this is the collection of graduate students who are advised by the chair of the
Computer Science department. Now, suppose that a query is needed to retrieve the
last and first names of these graduate students, plus the list of previous degrees of
each. This can be written as in Q4A, where the variable S ranges over the collection
of graduate students advised by the chairperson, and the variable D ranges over the
degrees of each such student S. The type of the result of Q4A is a collection of (first-
level) structs where each struct has two components: name and degrees.*?

4°As mentioned earlier, struct corresponds to the tuple constructor discussed in Section 12.1.3.

411